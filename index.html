<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ì´ë²¤íŠ¸ ì‘ëª¨ í˜ì´ì§€</title>
<style>
  body {
    font-family: "Pretendard", sans-serif;
    background: #f9fafb;
    color: #333;
    text-align: center;
    padding: 40px;
  }
  .container {
    max-width: 500px;
    margin: 0 auto;
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    padding: 30px;
  }
  input[type=text], input[type=tel] {
    width: 90%;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
    margin: 10px 0;
    font-size: 16px;
  }
  input[type=checkbox] { margin-right: 8px; }
  button {
    background: #007bff;
    color: white;
    border: none;
    padding: 10px 18px;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    margin-top: 10px;
  }
  button:hover { background: #0056b3; }
  .admin-link { margin-top: 20px; font-size: 14px; color: #777; cursor: pointer; }
  .hidden { display: none; }
  table { width: 100%; border-collapse: collapse; margin-top: 15px; }
  th, td { border: 1px solid #ddd; padding: 6px; text-align: center; }
  th { background: #f3f4f6; }
  .admin-btns button { margin: 5px 0; background: #4b5563; }
</style>
</head>
<body>

<div class="container" id="apply-section">
  <h2>ğŸ‰ ë¹¼ë¹¼ë¡œ ì´ë²¤íŠ¸ ì‘ëª¨ ğŸ‰</h2>
  <p>ëª¨ë“  í•­ëª©ì„ ì‘ì„± í›„ ì‘ëª¨ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>

  <input type="text" id="nickname" placeholder="ë‹‰ë„¤ì„(ì´ë¦„)">
  <input type="text" id="extraInfo" placeholder="ê´€ë¦¬ìì—ê²Œ í•œ ë§ˆë””!">
  <input type="tel" id="contact" placeholder="ì—°ë½ì²˜ ì…ë ¥">

  <label><input type="checkbox" id="agree"> ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš©ì— ë™ì˜í•©ë‹ˆë‹¤.</label>
  <p style="font-size:0.8rem; color:#555; margin-top:-6px;">
    ìˆ˜ì§‘í•­ëª©: ì—°ë½ì²˜<br>
    ì´ìš©ëª©ì : ì´ë²¤íŠ¸ ì§„í–‰ ë° ê²½í’ˆ ë°œì†¡<br>
    ë³´ìœ ê¸°ê°„: ë‹¹ì²¨ì ë°œí‘œ í›„ 3ì¼
  </p>

  <button id="submit-btn">ì‘ëª¨í•˜ê¸°</button>
  <p id="message"></p>
  <p class="admin-link" id="admin-link">ğŸ” ê´€ë¦¬ì ì „ìš©</p>
</div>

<!-- ê´€ë¦¬ì íŒ¨ë„ -->
<div class="container hidden" id="admin-section">
  <h3>ê´€ë¦¬ì í˜ì´ì§€</h3>
  <table id="entry-table">
    <thead><tr><th>ë‹‰ë„¤ì„</th><th>ê´€ë¦¬ìì—ê²Œ í•œ ë§ˆë””!</th><th>ì—°ë½ì²˜</th><th>ì‘ëª¨ì‹œê°„</th></tr></thead>
    <tbody></tbody>
  </table>
  <div class="admin-btns">
    <button id="download-csv">CSV ë‹¤ìš´ë¡œë“œ</button>
    <button id="clear-data">ì „ì²´ ì´ˆê¸°í™”</button>
    <button onclick="hideAdmin()">ë‹«ê¸°</button>
  </div>
</div>

<script>
const ADMIN_CODE = "toddlf*83*";

// ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë¶ˆëŸ¬ì˜¤ê¸°
let entries = JSON.parse(localStorage.getItem("entries") || "[]");
let hasApplied = localStorage.getItem("hasApplied") === "true";

const submitBtn = document.getElementById("submit-btn");
const message = document.getElementById("message");
const adminLink = document.getElementById("admin-link");
const adminSection = document.getElementById("admin-section");
const applySection = document.getElementById("apply-section");

// ì‘ëª¨ ë²„íŠ¼
submitBtn.addEventListener("click", () => {
  const nickname = document.getElementById("nickname").value.trim();
  const extraInfo = document.getElementById("extraInfo").value.trim();
  const contact = document.getElementById("contact").value.trim();
  const agree = document.getElementById("agree").checked;

  if (!nickname || !contact) return message.textContent = "í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”.";
  if (!agree) return message.textContent = "ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë™ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.";
  if (hasApplied) return message.textContent = "ì´ë¯¸ ì‘ëª¨í•˜ì…¨ìŠµë‹ˆë‹¤!";

  const now = new Date().toLocaleString();
  entries.push({ nickname, extraInfo, contact, time: now });
  localStorage.setItem("entries", JSON.stringify(entries));
  localStorage.setItem("hasApplied", "true");
  hasApplied = true;
  message.textContent = "ì‘ëª¨ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!";
});

// ê´€ë¦¬ì ì ‘ê·¼
adminLink.addEventListener("click", () => {
  const code = prompt("ê´€ë¦¬ì ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
  if (code === ADMIN_CODE) showAdmin();
  else alert("ì½”ë“œê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
});

function showAdmin() {
  applySection.classList.add("hidden");
  adminSection.classList.remove("hidden");
  refreshTable();
}

function hideAdmin() {
  adminSection.classList.add("hidden");
  applySection.classList.remove("hidden");
}

// í…Œì´ë¸” ê°±ì‹ 
function refreshTable() {
  const tbody = document.querySelector("#entry-table tbody");
  tbody.innerHTML = entries.map(e => `<tr>
    <td>${e.nickname}</td>
    <td>${e.extraInfo}</td>
    <td>${e.contact}</td>
    <td>${e.time}</td>
  </tr>`).join("");
}

// CSV ë‹¤ìš´ë¡œë“œ
document.getElementById("download-csv").addEventListener("click", () => {
  if (entries.length === 0) return alert("ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
  const csv = "ë‹‰ë„¤ì„,ê´€ë¦¬ìì—ê²Œ í•œ ë§ˆë””,ì—°ë½ì²˜,ì‘ëª¨ì‹œê°„\n" +
    entries.map(e => `${e.nickname},${e.extraInfo},${e.contact},${e.time}`).join("\n");
  const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "ì‘ëª¨ì_ëª©ë¡.csv";
  a.click();
});

// ì „ì²´ ì´ˆê¸°í™”
document.getElementById("clear-data").addEventListener("click", () => {
  if (!confirm("ëª¨ë“  ì‘ëª¨ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
  entries = [];
  localStorage.removeItem("entries");
  localStorage.removeItem("hasApplied");
  refreshTable();
  alert("ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!");
});

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ë¯¸ ì‘ëª¨í•œ ê²½ìš°
if (hasApplied) message.textContent = "ì´ë¯¸ ì‘ëª¨í•˜ì…¨ìŠµë‹ˆë‹¤!";
</script>

</body>
</html>
